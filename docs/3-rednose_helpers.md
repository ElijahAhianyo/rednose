# Rednose Helpers

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-rednose.helpers.__init__.load_code-start--->
## [rednose.helpers.__init__.load_code](3-rednose_helpers.md#rednose.helpers.__init__.load_code)

<!---Documatic-section-load_code-start--->
<!---Documatic-block-rednose.helpers.__init__.load_code-start--->
<details>
	<summary><code>rednose.helpers.__init__.load_code</code> code snippet</summary>

```python
def load_code(folder, name, lib_name=None):
    if lib_name is None:
        lib_name = name
    shared_ext = 'dylib' if platform.system() == 'Darwin' else 'so'
    shared_fn = os.path.join(folder, f'lib{lib_name}.{shared_ext}')
    header_fn = os.path.join(folder, f'{name}.h')
    with open(header_fn) as f:
        header = f.read()
    header = '\n'.join([line for line in header.split('\n') if line.startswith('void ')])
    ffi = FFI()
    ffi.cdef(header)
    return (ffi, ffi.dlopen(shared_fn))
```
</details>
<!---Documatic-block-rednose.helpers.__init__.load_code-end--->
<!---Documatic-section-load_code-end--->

# #
<!---Documatic-section-rednose.helpers.__init__.load_code-end--->

<!---Documatic-section-rednose.helpers.__init__.write_code-start--->
## [rednose.helpers.__init__.write_code](3-rednose_helpers.md#rednose.helpers.__init__.write_code)

<!---Documatic-section-write_code-start--->
<!---Documatic-block-rednose.helpers.__init__.write_code-start--->
<details>
	<summary><code>rednose.helpers.__init__.write_code</code> code snippet</summary>

```python
def write_code(folder, name, code, header):
    if not os.path.exists(folder):
        os.mkdir(folder)
    open(os.path.join(folder, f'{name}.cpp'), 'w').write(code)
    open(os.path.join(folder, f'{name}.h'), 'w').write(header)
```
</details>
<!---Documatic-block-rednose.helpers.__init__.write_code-end--->
<!---Documatic-section-write_code-end--->

# #
<!---Documatic-section-rednose.helpers.__init__.write_code-end--->

<!---Documatic-section-rednose.helpers.sympy_helpers.rot_matrix-start--->
## [rednose.helpers.sympy_helpers.rot_matrix](3-rednose_helpers.md#rednose.helpers.sympy_helpers.rot_matrix)

<!---Documatic-section-rot_matrix-start--->
<!---Documatic-block-rednose.helpers.sympy_helpers.rot_matrix-start--->
<details>
	<summary><code>rednose.helpers.sympy_helpers.rot_matrix</code> code snippet</summary>

```python
def rot_matrix(roll, pitch, yaw):
    (cr, sr) = (np.cos(roll), np.sin(roll))
    (cp, sp) = (np.cos(pitch), np.sin(pitch))
    (cy, sy) = (np.cos(yaw), np.sin(yaw))
    rr = np.array([[1, 0, 0], [0, cr, -sr], [0, sr, cr]])
    rp = np.array([[cp, 0, sp], [0, 1, 0], [-sp, 0, cp]])
    ry = np.array([[cy, -sy, 0], [sy, cy, 0], [0, 0, 1]])
    return ry.dot(rp.dot(rr))
```
</details>
<!---Documatic-block-rednose.helpers.sympy_helpers.rot_matrix-end--->
<!---Documatic-section-rot_matrix-end--->

# #
<!---Documatic-section-rednose.helpers.sympy_helpers.rot_matrix-end--->

<!---Documatic-section-rednose.helpers.sympy_helpers.quat_rotate-start--->
## [rednose.helpers.sympy_helpers.quat_rotate](3-rednose_helpers.md#rednose.helpers.sympy_helpers.quat_rotate)

<!---Documatic-section-quat_rotate-start--->
<!---Documatic-block-rednose.helpers.sympy_helpers.quat_rotate-start--->
<details>
	<summary><code>rednose.helpers.sympy_helpers.quat_rotate</code> code snippet</summary>

```python
def quat_rotate(q0, q1, q2, q3):
    return sp.Matrix([[q0 ** 2 + q1 ** 2 - q2 ** 2 - q3 ** 2, 2 * (q1 * q2 + q0 * q3), 2 * (q1 * q3 - q0 * q2)], [2 * (q1 * q2 - q0 * q3), q0 ** 2 - q1 ** 2 + q2 ** 2 - q3 ** 2, 2 * (q2 * q3 + q0 * q1)], [2 * (q1 * q3 + q0 * q2), 2 * (q2 * q3 - q0 * q1), q0 ** 2 - q1 ** 2 - q2 ** 2 + q3 ** 2]]).T
```
</details>
<!---Documatic-block-rednose.helpers.sympy_helpers.quat_rotate-end--->
<!---Documatic-section-quat_rotate-end--->

# #
<!---Documatic-section-rednose.helpers.sympy_helpers.quat_rotate-end--->

<!---Documatic-section-rednose.helpers.sympy_helpers.sympy_into_c-start--->
## [rednose.helpers.sympy_helpers.sympy_into_c](3-rednose_helpers.md#rednose.helpers.sympy_helpers.sympy_into_c)

<!---Documatic-section-sympy_into_c-start--->
<!---Documatic-block-rednose.helpers.sympy_helpers.sympy_into_c-start--->
<details>
	<summary><code>rednose.helpers.sympy_helpers.sympy_into_c</code> code snippet</summary>

```python
def sympy_into_c(sympy_functions, global_vars=None):
    from sympy.utilities import codegen
    routines = []
    for (name, expr, args) in sympy_functions:
        r = codegen.make_routine(name, expr, language='C99', global_vars=global_vars)
        nargs = []
        for aa in args:
            if aa is None:
                nargs.append(codegen.InputArgument(sp.Symbol('unused'), dimensions=[1, 1]))
                continue
            found = False
            for a in r.arguments:
                if str(aa.name) == str(a.name):
                    nargs.append(a)
                    found = True
                    break
            if not found:
                nargs.append(codegen.InputArgument(aa, dimensions=[1, 1]))
        for a in r.arguments:
            if type(a) == codegen.OutputArgument:
                nargs.append(a)
        r.arguments = nargs
        routines.append(r)
    [(_, c_code), (_, c_header)] = codegen.get_code_generator('C', 'ekf', 'C99').write(routines, 'ekf')
    c_header = '\n'.join((x for x in c_header.split('\n') if len(x) > 0 and x[0] != '#'))
    c_code = '\n'.join((x for x in c_code.split('\n') if len(x) > 0 and x[0] != '#'))
    return (c_header, c_code)
```
</details>
<!---Documatic-block-rednose.helpers.sympy_helpers.sympy_into_c-end--->
<!---Documatic-section-sympy_into_c-end--->

# #
<!---Documatic-section-rednose.helpers.sympy_helpers.sympy_into_c-end--->

<!---Documatic-section-rednose.helpers.sympy_helpers.quat_matrix_l-start--->
## [rednose.helpers.sympy_helpers.quat_matrix_l](3-rednose_helpers.md#rednose.helpers.sympy_helpers.quat_matrix_l)

<!---Documatic-section-quat_matrix_l-start--->
<!---Documatic-block-rednose.helpers.sympy_helpers.quat_matrix_l-start--->
<details>
	<summary><code>rednose.helpers.sympy_helpers.quat_matrix_l</code> code snippet</summary>

```python
def quat_matrix_l(p):
    return sp.Matrix([[p[0], -p[1], -p[2], -p[3]], [p[1], p[0], -p[3], p[2]], [p[2], p[3], p[0], -p[1]], [p[3], -p[2], p[1], p[0]]])
```
</details>
<!---Documatic-block-rednose.helpers.sympy_helpers.quat_matrix_l-end--->
<!---Documatic-section-quat_matrix_l-end--->

# #
<!---Documatic-section-rednose.helpers.sympy_helpers.quat_matrix_l-end--->

<!---Documatic-section-rednose.helpers.chi2_lookup.chi2_ppf-start--->
## [rednose.helpers.chi2_lookup.chi2_ppf](3-rednose_helpers.md#rednose.helpers.chi2_lookup.chi2_ppf)

<!---Documatic-section-chi2_ppf-start--->
<!---Documatic-block-rednose.helpers.chi2_lookup.chi2_ppf-start--->
<details>
	<summary><code>rednose.helpers.chi2_lookup.chi2_ppf</code> code snippet</summary>

```python
def chi2_ppf(p, dim):
    table = np.load(os.path.dirname(os.path.realpath(__file__)) + '/chi2_lookup_table.npy')
    result = np.interp(p, np.arange(0.01, 0.99, 0.01), table[dim])
    return result
```
</details>
<!---Documatic-block-rednose.helpers.chi2_lookup.chi2_ppf-end--->
<!---Documatic-section-chi2_ppf-end--->

# #
<!---Documatic-section-rednose.helpers.chi2_lookup.chi2_ppf-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)